# üßπ –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ–¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä

## –ü—Ä–æ–±–ª–µ–º–∞
–ù–µ—É–¥–∞—á–Ω—ã–π –¥–µ–ø–ª–æ–π –≤ –ø–∞–ø–∫—É `/opt/api-go` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ Selectel. –ù—É–∂–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—Å—Ç–∏—Ç—å –∏ —Å–¥–µ–ª–∞—Ç—å –Ω–æ–≤—ã–π –¥–µ–ø–ª–æ–π.

## –†–µ—à–µ–Ω–∏–µ

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ–¥–µ–ø–ª–æ–π

```bash
# –î–ª—è production
make clean-deploy ENV=prod SERVER=45.12.229.112 USER=root

# –î–ª—è staging
make clean-deploy ENV=staging SERVER=45.12.229.112 USER=root
```

### 2. –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@45.12.229.112

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
cd /opt/api-go
docker-compose down --remove-orphans --volumes
docker stop $(docker ps -aq)
docker rm $(docker ps -aq)

# –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤
docker rmi $(docker images -q)
docker system prune -af --volumes

# –û—á–∏—Å—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
sudo rm -rf /opt/api-go
sudo mkdir -p /opt/api-go
sudo chown root:root /opt/api-go
```

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç clean-deploy.sh

### üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞
- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –æ–±—Ä–∞–∑—ã –∏ volumes
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `/opt/api-go`

### üìÅ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ Go
- Nginx –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç/—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Go
- –°–æ–±–∏—Ä–∞–µ—Ç Docker –æ–±—Ä–∞–∑—ã
- –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞
- –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API
- –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫
```bash
make clean-deploy ENV=prod SERVER=45.12.229.112
```

### –° —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
make clean-deploy ENV=prod SERVER=45.12.229.112 USER=ubuntu
```

### –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ —Å–∫—Ä–∏–ø—Ç–∞
```bash
./scripts/clean-deploy.sh prod 45.12.229.112 root
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

- **ENV**: `staging` –∏–ª–∏ `prod`
- **SERVER**: IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ (45.12.229.112)
- **USER**: SSH –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é root)

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
- ‚úÖ –°–µ—Ä–≤–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω
- ‚úÖ –ù–æ–≤—ã–π –∫–æ–¥ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç
- ‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã
- ‚úÖ API –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://45.12.229.112:8082

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
ssh root@45.12.229.112 "cd /opt/api-go && docker-compose -f docker-compose.prod.yml ps"

# –õ–æ–≥–∏
ssh root@45.12.229.112 "cd /opt/api-go && docker-compose -f docker-compose.prod.yml logs -f api"

# Health check
curl http://45.12.229.112:8082/health
```

## ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ

- –°–∫—Ä–∏–ø—Ç **–ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—è–µ—Ç** –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ `/opt/api-go`
- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç **–≤—Å–µ** Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –£–¥–∞–ª—è–µ—Ç **–≤—Å–µ** Docker –æ–±—Ä–∞–∑—ã
- –¢—Ä–µ–±—É–µ—Ç **sudo** –ø—Ä–∞–≤–∞ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

## Troubleshooting

### –û—à–∏–±–∫–∞ SSH
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–π
ssh-add -l

# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
ssh -v root@45.12.229.112
```

### –û—à–∏–±–∫–∞ Docker
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh root@45.12.229.112 "docker --version"
ssh root@45.12.229.112 "docker-compose --version"
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
ssh root@45.12.229.112 "whoami && id"
``` 