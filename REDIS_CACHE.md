# üöÄ Redis –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è Products API

## üìã –û–±–∑–æ—Ä

–î–æ–±–∞–≤–ª–µ–Ω Redis –∫—ç—à –¥–ª—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏. –ö—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö.

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - GET –∑–∞–ø—Ä–æ—Å—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–£–º–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è** - –∫—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- **–ì–∏–±–∫–∏–µ –∫–ª—é—á–∏** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- **Graceful degradation** - API —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –±–µ–∑ Redis
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫—ç—à–∞

```
Redis Keys:
‚îú‚îÄ‚îÄ products:list                    # –û–±—â–∏–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
‚îú‚îÄ‚îÄ product:{id}                     # –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç –ø–æ ID
‚îú‚îÄ‚îÄ products:category:{category}     # –ü—Ä–æ–¥—É–∫—Ç—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
‚îî‚îÄ‚îÄ products:page:{page}:limit:{limit} # –ü—Ä–æ–¥—É–∫—Ç—ã —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
```

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **GET –∑–∞–ø—Ä–æ—Å—ã** - —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫—ç—à, –∑–∞—Ç–µ–º –ë–î
2. **POST/PUT/DELETE** - –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è –≤ –ë–î, –∫—ç—à –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** - –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∫—ç—à

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_TTL=3600  # –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
```

### Docker Compose

```yaml
redis:
  image: redis:7-alpine
  ports:
    - "6379:6379"
  volumes:
    - redis_data:/data
  command: redis-server --appendonly yes
```

## üìö API Endpoints

### –ö—ç—à —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫—ç—à–∞
GET /api/v1/cache/stats
Authorization: Bearer {JWT_TOKEN}

# –û—Ç–≤–µ—Ç
{
  "cache_stats": {
    "products:list": 1,
    "product:*": 5,
    "products:category:*": 3,
    "products:page:*": 2
  },
  "message": "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞ –ø–æ–ª—É—á–µ–Ω–∞"
}
```

### –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞

```bash
# –ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å –∫—ç—à –ø—Ä–æ–¥—É–∫—Ç–æ–≤
POST /api/v1/cache/invalidate
Authorization: Bearer {JWT_TOKEN}

# –û—Ç–≤–µ—Ç
{
  "message": "–í–µ—Å—å –∫—ç—à –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω"
}
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ó–∞–ø—É—Å–∫ Redis

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ Docker
make redis-start

# –ò–ª–∏ —á–µ—Ä–µ–∑ Docker Compose
make docker-up

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
make redis-cli
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞

```bash
# –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å - –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î, —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∫—ç—à
curl http://localhost:8080/api/v1/products
# X-Cache: MISS

# –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å - –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞
curl http://localhost:8080/api/v1/products
# X-Cache: HIT

# –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö - –∫—ç—à –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è
curl -X POST http://localhost:8080/api/v1/products \
  -H "Authorization: Bearer {TOKEN}" \
  -d '{"name":"–ù–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç","price":99.99}'
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞
curl -H "Authorization: Bearer {TOKEN}" \
  http://localhost:8080/api/v1/cache/stats

# –õ–æ–≥–∏ Redis
make redis-cli
# –í Redis CLI: INFO memory
```

## üîç –ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤

### X-Cache
- **HIT** - –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ –∫—ç—à–∞
- **MISS** - –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ –ë–î

### X-Cache-Save
- **failed** - –æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –∫—ç—à

### X-Cache-Invalidation
- **failed** - –æ—à–∏–±–∫–∞ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–∞

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ë–µ–∑ –∫—ç—à–∞
- **GET /products** - 50-100ms (–∑–∞–ø—Ä–æ—Å –∫ –ë–î)
- **GET /products/:id** - 10-20ms (–∑–∞–ø—Ä–æ—Å –∫ –ë–î)

### –° –∫—ç—à–µ–º
- **GET /products** - 5-10ms (–∏–∑ Redis)
- **GET /products/:id** - 1-3ms (–∏–∑ Redis)

**–£—Å–∫–æ—Ä–µ–Ω–∏–µ: 5-10x** üöÄ

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–µ–º

### –ö–æ–º–∞–Ω–¥—ã Makefile

```bash
make redis-start      # –ó–∞–ø—É—Å—Ç–∏—Ç—å Redis
make redis-stop       # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Redis
make redis-cli        # –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Redis CLI
make redis-flush      # –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å Redis
make cache-stats      # –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
```

### Redis CLI –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
make redis-cli

# –í Redis CLI:
KEYS products:*       # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–ª—é—á–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
INFO memory          # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–º—è—Ç–∏
FLUSHALL            # –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫—ç—à
TTL products:list   # –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–ª—é—á–∞
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **–ö—ç—à —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - —Ç—Ä–µ–±—É–µ—Ç JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞** - —Ç—Ä–µ–±—É–µ—Ç JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- **TTL** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å—Ç–µ—á–µ–Ω–∏–µ –∫—ç—à–∞

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```go
if err := redisClient.Connect(); err != nil {
    log.Printf("–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ: %v", err)
    // API –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∫—ç—à–∞
}
```

### –û—à–∏–±–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
```go
// –û—à–∏–±–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –æ—Å–Ω–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É
if err := h.cache.SetProducts(ctx, page, limit, category, products); err != nil {
    c.Header("X-Cache-Save", "failed")
}
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### –ú–µ—Ç—Ä–∏–∫–∏ –∫—ç—à–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–π –ø–æ —Ç–∏–ø–∞–º
- Hit/Miss ratio
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```go
log.Printf("–ü—Ä–æ–¥—É–∫—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –∫—ç—à–∞: %s", key)
log.Printf("–ö—ç—à –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∞ ID: %d", productID)
```

## üîÑ –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. Cache-Aside (Lazy Loading)
- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –∫—ç—à –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏

### 2. Write-Through
- –î–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∫—ç—à –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

### 3. TTL (Time To Live)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å—Ç–µ—á–µ–Ω–∏–µ –∫—ç—à–∞
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —É—Å—Ç–∞—Ä–µ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

## üåü –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - 5-10x —É—Å–∫–æ—Ä–µ–Ω–∏–µ  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - Redis –∫–ª–∞—Å—Ç–µ—Ä –¥–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫  
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - Graceful degradation –±–µ–∑ Redis  
‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ü–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - –£–º–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞  
‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –∫–ª—é—á–∏ –∏ TTL  

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **Redis –∫–ª–∞—Å—Ç–µ—Ä** - –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫
2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
3. **CDN –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
4. **–ú–µ—Ç—Ä–∏–∫–∏ Prometheus** - –¥–µ—Ç–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
5. **–ö—ç—à warming** - –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

Redis –∫—ç—à –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ 